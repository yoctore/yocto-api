"use strict";function Controller(){this.tabModel=[],this.mongoose=mongoose,this.logger=logger}var _=require("lodash"),mongoose=require("mongoose"),logger=require("yocto-logger"),Schema=mongoose.Schema,path=require("path"),glob=require("glob"),fs=require("fs"),joi=require("joi"),listValidTypeForJoi=["String","ObjectId","Number","Boolean"],modelJoiSchema=joi.object().keys({name:joi.string().required().min(1).trim(),properties:joi.object().required().min(1).pattern(/.+/,[joi.object().keys({type:[joi.string().required().valid(listValidTypeForJoi),joi.array().min(1).items(joi.string().valid(listValidTypeForJoi))],required:joi["boolean"]()["default"](!0)}),joi.array().min(1).items(joi.string().valid(listValidTypeForJoi)),joi.string().valid(listValidTypeForJoi)])});Controller.prototype.addModel=function(a){var b=modelJoiSchema.validate(a);if(_.isEmpty(b)||_.isEmpty(b.error))try{this.model=new Schema(a.properties);var c=[a.name,a.properties],d=this.mongoose.model.apply(this.mongoose,c);return this.tabModel.push({name:a.name,mongooseModel:d}),!0}catch(e){return this.logger.error("[ ControllerModel.addModel ] - error, more details : "+e),!1}return logger.error("[ ControllerModel.addModel ] - error in JOI validation "),_.forEach(b.error.details,function(a){this.logger.warning("[ ControllerRoutes.init ] - "+a.message+" at "+a.path)},this),!1},Controller.prototype.init=function(a){this.logger.info("[ ControllerModels.init ] - start"),_.each(_.words(glob.sync(a+"*.json","cwd"),/[^,,]+/g),function(a){try{var b=JSON.parse(fs.readFileSync(a),"utf-8");this.addModel(b.models.model)}catch(c){this.logger.error("[ ControllerModels.init() ] - error rencountring during init, more details : "+c)}},this)},Controller.prototype.getModel=function(a){if(!_.isEmpty(a)&&_.isString(a)){var b=_.findIndex(this.tabModel,{name:a});if(_.isUndefined(b)||b>=0)return this.logger.info("[ ControllerModels.getModel ] - get Model of : "+a),this.tabModel[b].mongooseModel}return this.logger.error("[ ControllerModels.getModel ] - error model not found, model name is : "+a),!1},module.exports=new Controller;