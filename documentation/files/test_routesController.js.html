<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>test/routesController.js - yocto-api</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="yocto-api" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/.html"></a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: test/routesController.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Unit tests
 */
var expect    = require(&quot;chai&quot;).expect;
var path      = require(&#x27;path&#x27;);
var base      = path.normalize(process.cwd());
var _         = require(&#x27;lodash&#x27;);
var routes    = require(&#x27;../src/app/routes/controller.js&#x27;); // Load the api
var modelsCtl = require(&#x27;../src/app/models/controller.js&#x27;); // Load the api


routes.logger.enableConsole(false); // Disable log


describe(&quot;routes/Controller &quot;, function() {

  //A FACTORISER !!!!!
  describe(&quot;init()&quot;, function() {

    it(&quot;Init whit good paths files - should be true&quot;, function() {
      var init = routes.init(base+&#x27;/example/routes/routes.json&#x27;, base +&#x27;/example/models/&#x27;);
      expect(init).to.equal(true);

      //Delete all mongoose models
      _.each(routes.models.mongoose.models, function(val) {
        delete routes.models.mongoose.models[val.modelName];
      });
    });

    it(&quot;Init whit wrong path file for routes.json - should be false&quot;, function() {
      var init = routes.init(base+&#x27;/example/routes/routeaaas.json&#x27;, base +&#x27;/example/models/&#x27;);
      expect(init).to.equal(false);

      //Delete all mongoose models
      _.each(routes.models.mongoose.models, function(val) {
        delete routes.models.mongoose.models[val.modelName];
      });
    });

    it(&quot;Init whit wrong paths files for model and routes.json - should be false&quot;, function() {
      var init = routes.init(base+&#x27;/example/routes/routeaaas.json&#x27;, base +&#x27;/example/modelaaas/&#x27;);
      expect(init).to.equal(false);

      //Delete all mongoose models
      _.each(routes.models.mongoose.models, function(val) {
        delete routes.models.mongoose.models[val.modelName];
      });
    });

    it(&quot;Init whit wrong path file for model - should be false&quot;, function() {
      var init = routes.init(base+&#x27;/example/routes/routes.json&#x27;, base +&#x27;/example/modelaaas/&#x27;);
      expect(init).to.equal(false);

      //Delete all mongoose models
      _.each(routes.models.mongoose.models, function(val) {
        delete routes.models.mongoose.models[val.modelName];
      });
    });

    it(&quot;Init whit invalid routes config files - should be true&quot;, function() {
      var init = routes.init(base+&#x27;/example/invalid-config/routes/routes.json&#x27;, base +&#x27;/example/models/&#x27;);
      expect(init).to.equal(true);

      //Delete all mongoose models
      _.each(routes.models.mongoose.models, function(val) {
        delete routes.models.mongoose.models[val.modelName];
      });
    });

    it(&quot;Init whit invalid models and routes config  files - should be true&quot;, function() {
      var init = routes.init(base+&#x27;/example/invalid-config/routes/routes.json&#x27;, base +&#x27;/example/invalid-config/models/&#x27;);
      expect(init).to.equal(true);

      //Delete all mongoose models
      _.each(routes.models.mongoose.models, function(val) {
        delete routes.models.mongoose.models[val.modelName];
      });
    });

    it(&quot;Init whit invalid models config files - should be true&quot;, function() {
      var init = routes.init(base+&#x27;/example/routes/routes.json&#x27;, base +&#x27;/example/invalid-config/models/&#x27;);
      expect(init).to.equal(true);

      //Delete all mongoose models
      _.each(routes.models.mongoose.models, function(val) {
        delete routes.models.mongoose.models[val.modelName];
      });
    });
  });

  describe(&quot;addRoutes()&quot;, function() {
    var data = [
      { &quot;path&quot; : &quot;/users&quot;, &quot;alias&quot; : [&quot;/user&quot;], &quot;model&quot; : &quot;user&quot;, &quot;paramToRetrieve&quot; : [&quot;user_id&quot;], &quot;requestExcluded&quot; : [&quot;put&quot;, &quot;delete&quot; , &quot;patch&quot;], &quot;expectValue&quot; : true},
      { &quot;path&quot; : &quot;/users&quot;, &quot;alias&quot; : [&quot;/user&quot;], &quot;model&quot; : &quot;user&quot;, &quot;paramToRetrieve&quot; : &#x27;&#x27;, &quot;requestExcluded&quot; : [&quot;put&quot;, &quot;delete&quot; , &quot;patch&quot;], &quot;expectValue&quot; : true},
    ];

    _.each(data, function(route) {
      it(&#x27;Add a routes with datas : &#x27; + JSON.stringify(route) + &#x27; - should return &#x27; + route.expectValue , function() {
        var addRoute = routes.addRoute(route.path, route.model, route.requestExcluded, route.paramToRetrieve);
        expect(addRoute).to.equal(route.expectValue);
      });
    });
  });

  describe(&quot;getFunctionName()&quot;, function() {
    var data = [
      { &quot;message&quot; : &quot;valid dataformat, but fake value&quot;, &quot;varToTest&quot; : &quot;thisIsAGreatFakeValue&quot;, &quot;expectValue&quot; : &#x27;findById&#x27; },
      { &quot;varToTest&quot; : 2, &quot;expectValue&quot; : &#x27;findById&#x27; },
      { &quot;varToTest&quot; : true, &quot;expectValue&quot; : &#x27;findById&#x27; },
      { &quot;varToTest&quot; : {&#x27;toto&#x27; : &#x27;tata&#x27;}, &quot;expectValue&quot; : &#x27;findById&#x27; },
      { &quot;varToTest&quot; : {&#x27;toto&#x27; : &#x27;tata&#x27;}, &quot;expectValue&quot; : &#x27;findById&#x27; },
      { &quot;expectValue&quot; : &#x27;find&#x27; }
    ];

    _.each(data, function(val) {
      it(&#x27;test this value : &#x27; + JSON.stringify(val) + &#x27; - should return &#x27; + val.expectValue , function() {
        var fnToTest = routes.getFunctionName(val.varToTest);
        expect(fnToTest).to.equal(val.expectValue);
      });
    });
  });


});

describe(&quot;models/Controller &quot;, function() {
  describe(&quot;addModel()&quot;, function() {
    var data = [
      {
        &quot;name&quot;      : &quot;user&quot;,
        &quot;properties&quot; : {
          &quot;name&quot;      : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;firstname&quot; : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;email&quot;     : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;cart_id&quot;   : [&quot;ObjectId&quot;]
        },
        &quot;expectValue&quot; : true
      },
      {
        &quot;message&quot;   : &quot;Add twice the same model, &quot;,
        &quot;name&quot;      : &quot;user&quot;,
        &quot;properties&quot; : {
          &quot;name&quot;      : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;firstname&quot; : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;email&quot;     : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;cart_id&quot;   : [&quot;ObjectId&quot;]
        },
        &quot;expectValue&quot; : false
      },
      {
        &quot;name&quot;      : 123,
        &quot;properties&quot; : {
          &quot;name&quot;      : {
            &quot;type&quot; : &quot;ererere&quot;,
            &quot;required&quot; : true
          },
          &quot;firstname&quot; : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;email&quot;     : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;cart_id&quot;   : [&quot;ObjectId&quot;]
        },
        &quot;expectValue&quot; : false
      },
      {&#x27;toto&#x27; : &#x27;tata&#x27;,
      &quot;expectValue&quot; : false}
    ];

    _.each(data, function(val) {
      it( (val.message ? val.message : &#x27;&#x27;) + &#x27;test add value : &#x27; + JSON.stringify(_.omit(val, &#x27;expectValue&#x27;)) + &#x27; - should return &#x27; + val.expectValue , function() {
        var fnToTest = modelsCtl.addModel(_.omit(val, &#x27;expectValue&#x27;));
        expect(fnToTest).to.equal(val.expectValue);
      });
    });
  });

  describe(&quot;getModel()&quot;, function() {

    var modelData = {
        &quot;name&quot;      : &quot;modelTest&quot;,
        &quot;properties&quot; : {
          &quot;name&quot;      : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;firstname&quot; : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;email&quot;     : {
            &quot;type&quot; : &quot;String&quot;,
            &quot;required&quot; : true
          },
          &quot;cart_id&quot;   : [&quot;ObjectId&quot;]
        }
      };

    modelsCtl.addModel(modelData);

    it(&#x27;test getModel with correct model - should be an Object&#x27;, function() {
      var fnToTest = modelsCtl.getModel(&#x27;modelTest&#x27;);
      expect(fnToTest).to.be.an(&#x27;Function&#x27;);
    });

    var data = [
      { &quot;message&quot; : &quot;valid dataformat, but fake value&quot;, &quot;varToTest&quot; : &quot;thisIsAGreatFakeValue&quot;, &quot;expectValue&quot; : false },
      { &quot;varToTest&quot; : 2, &quot;expectValue&quot; : false },
      { &quot;varToTest&quot; : true, &quot;expectValue&quot; : false },
      { &quot;varToTest&quot; : {&#x27;toto&#x27; : &#x27;tata&#x27;}, &quot;expectValue&quot; : false },
      { &quot;expectValue&quot; : false }
    ];

    _.each(data, function(val) {
      it((val.message ? val.message : &#x27;&#x27;) + &#x27;test add value : &#x27; + JSON.stringify(_.omit(val, &#x27;expectValue&#x27;)) + &#x27; - should return &#x27; + val.expectValue , function() {
        var fnToTest = modelsCtl.getModel(val.varToTest);
        expect(fnToTest).to.equal(val.expectValue);
      });
    });

  });


});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
